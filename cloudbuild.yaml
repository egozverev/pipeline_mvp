steps:
  - name: 'gcr.io/cloud-builders/git'
    args: ['clone', 'https://github.com/mapaction/pipeline_mvp']
    id: 'check-out-source-code'
  - name: 'python:3.7'
    entrypoint: 'bash'
    args:
      - '-c'
      - |
        pip install -r requirements.txt
        python -m pytest .
  - name: 'docker'
    args: ['build', 
           '-t', 'eu.gcr.io/datapipeline-295515/mapaction-cloudcomposer-kubernetes-image:$COMMIT_SHA',
           '-f', 'docker/kubernetesPodOperator.Dockerfile',
           '.']
    id: 'build-k8s-operator-image'
images:
  - 'eu.gcr.io/datapipeline-295515/mapaction-cloudcomposer-kubernetes-image:$COMMIT_SHA'
